const lista = [
    {
        id: 1,
        nombre: "Spiderman Hunter",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderma-zombie-hunter.jpg",
        precio: 100
    },
    {
        id: 2,
        nombre: "Miles Morales",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-Miles-Morales.jpg",
        precio: 100
    },
    {
        id: 3,
        nombre: "Spiderman antiock",
        category: "spiderman",
        descripcion:"",
        img: "./img/Spiderman/Spiderman-antiOck.jpg ",
        precio: 100
    },
    {
        id: 4,
        nombre: "Spiderman Cyborg",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-Cyborg.jpg" ,
        precio: 100
    },
    {
        id: 5,
        nombre: "Spiderman no way home",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-no-way-home.jpg",
        precio: 100
    },
    {
        id: 6,
        nombre: "Spiderman ps4",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-ps4.jpg",
        precio: 100
    },
    {
        id: 7,
        nombre: "Tobe Maguire",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-Tobey-Maguire.jpg",
        precio: 100
    },
    {
        id: 8,
        nombre: "Spiderman Casero",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-traje-casero.jpg",
        precio: 100
    },
    {
        id: 9,
        nombre: "Spiderman sigilo",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-traje-sigilo.jpg",
        precio: 100
    },
    {
        id: 10,
        nombre: "Spiderman vs Buitre",
        category: "spiderman",
        descripcion: "",
        img: "./img/Spiderman/Spiderman-vs-Buitre.jpg",
        precio: 100
    },{
        id: 11,
        nombre: "Capitan America 2",
        category: "capitan",
        descripcion: "",
        img: "./img/Capitan/Capitan-America-2.jpg",
        precio: 100
    },
    {
        id: 12,
        nombre: "Capitan America 2012",
        category: "capitan",
        descripcion: "",
        img: "./img/Capitan/Capitan-America-2012.jpg",
        precio: 100
    },
    {
        id: 13,
        nombre: "Capitan America EndGame",
        category: "capitan",
        descripcion: "",
        img: "./img/Capitan/Capitan-America-End-Game.jpg",
        precio: 100
    },
    {
        id: 14,
        nombre: "Sam Wilson",
        category: "capitan",
        descripcion: "",
        img: "./img/Capitan/Capitan-America-Sam-Wilson.jpg",
        precio: 100
    },
    {
        id: 15,
        nombre: "Mark XLVI",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Iron-Man-Mark-XLVI.jpg",
        precio: 100
    },
    {
        id: 16,
        nombre: "Mark L",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Iron-Man-Mark-L.jpg",
        precio: 100
    },
    {
        id: 17,
        nombre: "Mark LXXXV Tony Stark",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Iron-Man-Mark-LXXXV-Tony-Stark.jpg",
        precio: 100
    },
    {
        id: 18,
        nombre: "Mark LXXXV",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/iron-man-mark-lxxxv.jpg",
        precio: 100
    },
    {
        id: 19,
        nombre: "Mark XLII",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Iron-Man-Mark-XLII.jpg",
        precio: 100
    },
    {
        id: 20,
        nombre: "Mark 1",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Mark-1.jpg",
        precio: 100
    },
    {
        id: 21,
        nombre: "Reactor Arc",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Reactor-arc.jpg",
        precio: 100
    },
    {
        id: 22,
        nombre: "iron-man",
        category: "iron-man",
        descripcion: "",
        img: "./img/Iron-Man/Tony-Stark.jpg",
        precio: 100
    },
    {
        id: 23,
        nombre: "Loki 2012",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Loki-2012.jpg",
        precio: 100
    },
    {
        id: 24,
        nombre: "Loki Clasico",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Loki-Clasico.jpg",
        precio: 100
    },
    {
        id: 25,
        nombre: "Loki",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Loki.jpg",
        precio: 100
    },
    {
        id: 26,
        nombre: "Mighty Thor",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Mighty-thor.jpg",
        precio: 100
    },
    {
        id: 27,
        nombre: "Loki Presidente",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Presidente-loki.jpg",
        precio: 100
    },
    {
        id: 28,
        nombre: "Sylvie",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Sylvie.jpg",
        precio: 100
    },
    {
        id: 29,
        nombre: "Thor EndGame",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Thor-EndGame.jpg",
        precio: 100
    },
    {
        id: 30,
        nombre: "Thor Love And Thunder",
        category: "thor",
        descripcion: "",
        img: "./img/Thor/Thor-Love-And-Thunder.jpg",
        precio: 100
    },
    {
        id: 31,
        nombre: "Tchalla",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Black-Panther-challa.jpg",
        precio: 100
    },
    {
        id: 32,
        nombre: "Black Panther",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Black-Panther.jpg",
        precio: 100
    },
    {
        id: 33,
        nombre: "Black Widow",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Black-Widow.jpg",
        precio: 100
    },
    {
        id: 34,
        nombre: "Bruja escarlata",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Bruja-escarlata.jpg",
        precio: 100
    },
    {
        id: 35,
        nombre: "Capitana Endgame",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Capitana-Marvel-Endgame.jpg",
        precio: 100
    },
    {
        id: 36,
        nombre: "Capitana Marvel",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Capitana-Marvel.jpg",
        precio: 100
    },
    {
        id: 37,
        nombre: "Dead Strange",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Dead-Strange.jpg",
        precio: 100
    },
    {
        id: 38,
        nombre: "Doctor Strange",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Doctor-Strange.jpg",
        precio: 100
    },
    {
        id: 39,
        nombre: "Hulk",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Hulk.jpg",
        precio: 100
    },
    {
        id: 40,
        nombre: "Kate Bishop",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Kate-Bishop.jpg",
        precio: 100
    },{
        id: 41,
        nombre: "Little Groot",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Little-groot.jpg",
        precio: 100
    },
    {
        id: 42,
        nombre: "Rocket",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Rocket.jpg",
        precio: 100
    },
    {
        id: 43,
        nombre: "Wolverine",
        category: "vengadores",
        descripcion: "",
        img: "./img/Vengadores/Wolverine.jpg",
        precio: 100
    },
    {
        id: 44,
        nombre: "Carnage",
        descripcion: "",
        img: "./img/Villanos/Carnage.jpg",
        precio: 100
    },
    {
        id: 45,
        nombre: "Doc Ock",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Doc-Ock.jpg",
        precio: 100
    },
    {
        id: 46,
        nombre: "Duende Verde traje",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Duende-verde-traje.jpg",
        precio: 100
    },
    {
        id: 47,
        nombre: "Duende Verde",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Duende-Verde.jpg",
        precio: 100
    },
    {
        id: 48,
        nombre: "Electro",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Electro.jpg",
        precio: 100
    },
    {
        id: 49,
        nombre: "Misterio",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Misterio.jpg",
        precio: 100
    },
    {
        id: 50,
        nombre: "Thanos Infinity War",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Thano-Infinity-war.jpg",
        precio: 100
    },
    {
        id: 51,
        nombre: "Thanos Endgame",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Thanos-batalla-final-endgame.jpg",
        precio: 100
    },
    {
        id: 52,
        nombre: "Thanos",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Thanos.jpg",
        precio: 100
    },
    {
        id: 53,
        nombre: "Ultron Infinito",
        category: "villanos",
        descripcion: "",
        img: "./img/Villanos/Ultron-Infinito.jpg",
        precio: 100
    }
]

// Variables


const cards = document.querySelectorAll(".card");
const btn_next = document.querySelector(".next");
const btn_prev = document.querySelector(".prev");
const container_cards = document.querySelector(".container-cards");

const btn_section = document.querySelector(".btn-section");
const container_section = document.querySelector(".container__section");
const btn_div = document.querySelector(".btn-div");
const btn_section_prev = document.querySelector(".btn-section-prev");



let contador = 0;
const lista_cards = [...cards];

btn_prev.addEventListener("click", () => {
    if(contador > 0){
        contador--;
        let ope = contador * -25;
        container_cards.style.transform = `translateX(${ope}%)`;
        container_cards.style.transition = "all 0.5s ease";
    }else{
        contador = 0;
        container_cards.style.transform = `translateX(0px)`;
    }
     
})
btn_next.addEventListener("click", () => {
    if(contador < 3){
        contador++;
        let ope = contador * -25;
        container_cards.style.transform = `translateX(${ope}%)`;
        container_cards.style.transition = "all 0.5s ease";
    }else{
        contador = 0;
        container_cards.style.transform = `translateX(0px)`;
    }
    
})

const next_section = (e) => {
    e.preventDefault();
    container_section.style.transform = "translateX(-50%)";
    container_section.style.transition = "all 1s ease";
}
const prev_section = (e) => {
    e.preventDefault();
    console.log("click");
    container_section.style.transform = "translateX(0%)";
    container_section.style.transition = "all 1s ease";
}
// function([string1, string2],target id,[color1,color2])    


function consoleText(words, id, colors) {
  if (colors === undefined) colors = ['#fff'];
  var visible = true;
  var con = document.getElementById('console');
  var letterCount = 1;
  var x = 1;
  var waiting = false;
  var target = document.getElementById(id)
  target.setAttribute('style', 'color:' + colors[0])
  window.setInterval(function() {

    if (letterCount === 0 && waiting === false) {
      waiting = true;
      target.innerHTML = words[0].substring(0, letterCount)
      window.setTimeout(function() {
        var usedColor = colors.shift();
        colors.push(usedColor);
        var usedWord = words.shift();
        words.push(usedWord);
        x = 1;
        target.setAttribute('style', 'color:' + colors[0])
        letterCount += x;
        waiting = false;
      }, 1000)
    } else if (letterCount === words[0].length + 1 && waiting === false) {
      waiting = true;
      window.setTimeout(function() {
        x = -1;
        letterCount += x;
        waiting = false;
      }, 1000)
    } else if (waiting === false) {
      target.innerHTML = words[0].substring(0, letterCount)
      letterCount += x;
    }
  }, 120)
  window.setInterval(function() {
    if (visible === true) {
      con.className = 'console-underscore hidden'
      visible = false;

    } else {
      con.className = 'console-underscore'

      visible = true;
    }
  }, 400)
}
//funcion hero 

const hero = document.querySelector(".hero__div");
const text = document.querySelector("#text")

const hero_display = () => {
   setTimeout(() => {
         hero.style.display = "none";
         text.style.display = "none";

   }, 5000);
}

//funcion mostrar productos

const products = size => {
    let dividedProducts = [];
    for(let i = 0; i < lista.length; i += size){
        dividedProducts.push(lista.slice(i, i + size));
    }
    return dividedProducts;
}


const productsController = {
    dividedProducts: products(6),
    NextProductIndex: 1,
    productsLimit: products(6).length,
}

const Products = document.querySelector(".container-productos");
const ProductsCart = document.querySelector(".container-cart");
const total = document.querySelector(".total");
const categories = document.querySelector(".categories");
const categoriesList = document.querySelectorAll(".category");

const btnload = document.querySelector(".btn-load");
const buybtn = document.querySelector(".btn-buy");
const cartCont = document.querySelector(".cart-cont");
const cartBtn = document.querySelector(".btn-label");
const btnDelete = document.querySelector(".btn-delete");

let cartitems = JSON.parse(localStorage.getItem("cart")) || [];

const saveLocalStorage = cartlist => {
    localStorage.setItem("cart", JSON.stringify(cartlist));
}

const renderProduct = ({id, nombre,descripcion,img,precio}) => {

     return `<div class="card-product">
                <img src=${img} alt="">
                <div class="product-info">
                    <h4>${nombre}</h4>
                    <p>${descripcion}</p>
                </div>
                <div class="product-info-buy">
                    <p>$${precio}</p>
                    <button class="btn-buy"
                    data-id='${id}'
                    data-nombre='${nombre}'
                    data-descripcion='${descripcion}'
                    data-img='${img}'
                    data-precio='${precio}'>Agregar al carrito</button>
                </div>
            </div>`
}

const renderDividedProducts = (index = 0) => {
    const productsToRender = productsController.dividedProducts[index];
    Products.innerHTML += productsToRender.map(renderProduct).join("");

}

const renderFilteredProducts = (category) => {
    const filteredProducts = lista.filter(product => product.category === category);
    Products.innerHTML = filteredProducts.map(renderProduct).join("");
}

const renderProducts = (index = 0, category = null) => {

    if(!category){
        renderDividedProducts(index)
    }else{
        renderFilteredProducts(category);
    }

}

const isLastIndex = () => productsController.NextProductIndex === productsController.productsLimit;


const showMoreProducts = () => {
    renderProducts(productsController.NextProductIndex);
    productsController.NextProductIndex++;
    if(isLastIndex()){
        btnload.style.display = "none";
    }
}

const changeShowMoreBtnState = (category) => {
    if(!category){
        btnload.classList.remove("hidden");
        return;
    }
    btnload.classList.add("hidden");

}

const changeFilterState = (category) => {
    changeShowMoreBtnState(category);
}


const applyFilter = (e) => {
    e.preventDefault();
    if(e.target.classList.contains("category"))return;
    const category = e.target.dataset.category;
    changeFilterState(category);
    console.log(category)
    if(!category){
        Products.innerHTML = "";
        renderProducts();
    }else{
        renderProducts(0, category);
    }
    
}





//funcion menu burger

const burger = document.querySelector(".nav-burger");
const nav = document.querySelector(".navbar__ul");

const burger_display = (e) => {
    burger.classList.toggle("active");
    nav.classList.toggle("active");
    if(cart.classList.contains("active")){
        cart.classList.remove("active");
    }
}

//funcion carrito

const cart_icon = document.querySelector(".cart-label");
const cart_cont = document.querySelector(".cart-cont");
const cart = document.querySelector(".cart");
const container_cart = document.querySelector(".container-cart");
const successModal = document.querySelector(".add-modal");

const cart_display = (e) => {
    cart.classList.toggle("active");
    if(nav.classList.contains("active")){
        nav.classList.remove("active");
        burger.classList.remove("active");
    }
}

//funcion render carrito

const rendercartProduct = ({id, nombre, descripcion, img, precio,quantity}) => {
         return `<div class="cart-item">
                    <img src="${img}" alt="">
                    <div class="item-info">
                        <h3 class="item-title">${nombre}</h3>
                        <p class="item-bid">${descripcion}</p>
                        <span class="item-price">$${precio}</span>
                    </div>
                    <div class="item-handler">
                        <span class="quantity-handler down" data-id="${id}">-</span>
                        <span class="item-quantity">${quantity}</span>
                        <span class="quantity-handler up" data-id="${id}">+</span>
                     </div>
                 </div>`
}

const getcartTotal = () => {
    return cartitems.reduce((acc, currentValue) => acc + Number(currentValue.precio) * currentValue.quantity, 0);
}

const showTotal = () => {
    total.innerHTML = `$${getcartTotal().toFixed(2)}`
}

const renderCart = (cartlist) => {
    if(!cartitems.length){
        container_cart.innerHTML = `<h2 class="empty-cart">El carrito esta vacio</h2>`;
        return;
    }
    container_cart.innerHTML = cartitems.map(rendercartProduct).join("");

}

//Agregar productos al carrito

const createCartProduct = (product) => {
    cartitems = [...cartitems, {...product, quantity: 1}];
}

const isExistingCartProduct = (product) => {
    return cartitems.some(cartitem => cartitem.id === product.id);
}

const showSuccessModal = (msg) => {
    successModal.classList.add("active-modal");
    successModal.textContent = msg;
    setTimeout(() => {
        successModal.classList.remove("active-modal");
    }, 1500);
}

const checkcartState = () => {
    saveLocalStorage();
    renderCart();
    showTotal();
}

const addUnitToProduct = (product) => {
    cartitems = cartitems.map(cartitem => cartitem.id === product.id ? 
        {...cartitem, quantity: cartitem.quantity + 1} : cartitem);
}


const addProducts = (e) => {
    if(!e.target.classList.contains("btn-buy"))return;
    const product = {id, nombre, descripcion, img, precio} = e.target.dataset;
    if(isExistingCartProduct(product)){
        addUnitToProduct(product);
        showSuccessModal("Se agrego una unidad al producto");
    }else{
        createCartProduct(product);
        showSuccessModal("Producto agregado al carrito");
    }

    checkcartState();
}

//funcion cerrar menu al hacer scroll

const closeOnScroll = () => {
    if(!nav.classList.contains("active") && !cart.classList.contains("active"))return;
    nav.classList.remove("active");
    burger.classList.remove("active");
    cart.classList.remove("active");
}

//funcion cerrar menu al hacer click

const closeOnClick = (e) => {
    if(!e.target.classList.contains("navbar-link"))return;
    nav.classList.remove("active");
    burger.classList.remove("active");
}





const init = () => {

    window.addEventListener("scroll", closeOnScroll); 
    nav.addEventListener("click", closeOnClick);
    renderProducts();
    btnload.addEventListener("click", showMoreProducts);
    categories.addEventListener("click", applyFilter);
    btn_section.addEventListener("click", next_section);
    btn_section_prev.addEventListener("click", prev_section);
    consoleText(['Proximo gran estreno.', '16 de febrero del 2023. Solo en cines'], 'text',['tomato','rebeccapurple']);
    hero.addEventListener("mouseover",hero_display);
    hero.addEventListener("touch",hero_display);
    burger.addEventListener("click", burger_display);
    cart_icon.addEventListener("click", cart_display);

    document.addEventListener("DOMContentLoaded", renderCart);
    document.addEventListener("DOMContentLoaded", showTotal);

    Products.addEventListener("click", addProducts);

}

init();